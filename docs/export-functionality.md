# 测试结果导出功能

## 功能概述

新增了测试完成后导出结果的功能，支持将测试结果导出为 **Markdown 表格**和 **CSV** 两种格式，方便用户保存和分享测试结果。

## 功能特性

### 🎯 智能文件命名

文件名格式：`测试类型_测试时间_测试ID.格式`

**示例**：
- `速度测试_2024-01-15T14-30-00_abc123.md`
- `解锁测试_2024-01-15T14-30-00_abc123.csv`
- `速度+解锁测试_2024-01-15T14-30-00_abc123.md`

### 📄 Markdown 格式

支持导出为 Markdown 表格格式，包含：

1. **测试概览**
   - 测试时间
   - 测试模式
   - 测试统计（成功/失败节点数）
   - 测试耗时
   - 平均延迟、下载速度、上传速度

2. **详细测试结果表格**
   - 节点名称、类型、IP地址
   - 延迟、抖动、丢包率
   - 下载速度、上传速度
   - 测试状态

3. **解锁测试结果表格**（如果启用）
   - 节点信息
   - 解锁平台
   - 支持状态和区域

### 📊 CSV 格式

支持导出为 CSV 格式，便于在 Excel 等工具中进一步分析：

1. **速度测试数据**
   - 包含所有数值字段，便于统计分析
   - 支持中文表头和内容

2. **解锁测试数据**
   - 每个平台一行记录
   - 支持状态和区域信息

## 使用方法

### 1. 运行测试

首先完成一次速度测试或解锁测试：

1. 配置测试参数
2. 选择测试模式（速度测试、解锁测试、或两者）
3. 点击"开始测试"按钮
4. 等待测试完成

### 2. 导出结果

测试完成后，会在测试结果下方显示导出区域：

```
📁 导出测试结果
文件名格式：速度+解锁测试_2024-01-15T14-30-00_abc123.格式

[导出 Markdown] [导出 CSV]
```

点击相应按钮即可下载对应格式的文件。

## 导出内容示例

### Markdown 格式示例

```markdown
# Clash SpeedTest 测试结果

**测试时间**: 2024/1/15 14:30:08
**测试模式**: 速度+解锁测试
**测试统计**: 总计 10 个节点，成功 8 个，失败 2 个
**测试耗时**: 2分15秒
**平均延迟**: 65.4 ms
**平均下载速度**: 45.8 Mbps
**平均上传速度**: 18.3 Mbps

## 详细测试结果

| 节点名称 | 类型 | IP地址 | 延迟(ms) | 抖动(ms) | 丢包率(%) | 下载(Mbps) | 上传(Mbps) | 状态 |
|----------|------|--------|----------|----------|-----------|------------|------------|------|
| 香港01 | vmess | 1.2.3.4 | 45.60 | 2.30 | 0.00 | 54.30 | 22.40 | 成功 |
| 新加坡02 | trojan | 5.6.7.8 | 78.90 | 4.10 | 1.20 | 33.00 | 11.80 | 成功 |

## 解锁测试结果

| 节点名称 | 类型 | IP地址 | 解锁平台 | 状态 |
|----------|------|--------|----------|------|
| 香港01 | vmess | 1.2.3.4 | Netflix | ✅ 香港 |
| 香港01 | vmess | 1.2.3.4 | YouTube | ✅ 香港 |
| 新加坡02 | trojan | 5.6.7.8 | Disney+ | ✅ 新加坡 |
```

### CSV 格式示例

```csv
节点名称,节点类型,IP地址,延迟(ms),抖动(ms),丢包率(%),下载速度(Mbps),上传速度(Mbps),状态
"香港01","vmess","1.2.3.4",45.60,2.30,0.00,54.30,22.40,"成功"
"新加坡02","trojan","5.6.7.8",78.90,4.10,1.20,33.00,11.80,"成功"

解锁测试结果
节点名称,节点类型,IP地址,解锁平台,支持状态,区域
"香港01","vmess","1.2.3.4","Netflix","支持","香港"
"香港01","vmess","1.2.3.4","YouTube","支持","香港"
"新加坡02","trojan","5.6.7.8","Disney+","支持","新加坡"
```

## 技术实现

### 前端实现

1. **数据处理**
   - 从 WebSocket 接收的测试结果数据中提取所需字段
   - 根据测试模式（速度/解锁/混合）生成不同的表格内容

2. **文件生成**
   - 使用 `Blob` API 创建文件内容
   - 使用 `URL.createObjectURL` 创建下载链接
   - 自动触发浏览器下载

3. **用户界面**
   - 只在测试完成后显示导出按钮
   - 实时显示文件名格式预览
   - 使用 Toast 提示导出状态

### 文件命名逻辑

```typescript
const generateFileName = (format: string) => {
  const testType = testConfig.testMode === 'both' ? '速度+解锁测试' : 
                   testConfig.testMode === 'speed_only' ? '速度测试' : '解锁测试'
  const timestamp = new Date().toISOString().slice(0, 19).replace(/:/g, '-')
  const testId = taskId || 'unknown'
  return `${testType}_${timestamp}_${testId}.${format}`
}
```

### 数据格式化

- **数值精度**：延迟、速度等数值保留 2 位小数
- **状态处理**：支持中英文状态显示
- **特殊字符**：CSV 格式中正确处理逗号和引号
- **编码支持**：UTF-8 编码确保中文正确显示

## 使用场景

1. **性能分析**：导出 CSV 在 Excel 中进行数据分析
2. **报告生成**：Markdown 格式适合插入到文档中
3. **结果分享**：将测试结果分享给他人
4. **历史记录**：保存测试结果用于对比分析
5. **故障排查**：详细的测试数据用于问题诊断

这个功能让用户能够方便地保存和处理测试结果，提升了工具的实用性和专业性。
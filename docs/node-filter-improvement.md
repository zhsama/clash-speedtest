# 节点过滤功能改进

## 问题描述

在之前的版本中，节点过滤功能（包含节点和排除节点）只支持英文逗号 `,` 作为分隔符，这对中文用户来说不够友好，因为中文输入法经常会输入中文逗号 `，`。

## 解决方案

现在已经修改前端代码，**同时支持中英文逗号作为分隔符**：

- 英文逗号：`,`
- 中文逗号：`，`
- 混合使用：`香港,新加坡，美国`

## 修改内容

### 1. 前端代码修改

修改了 `frontend/src/components/SpeedTest.tsx` 中的两个函数：

```typescript
const handleIncludeNodesChange = (value: string) => {
  setIncludeNodesInput(value)
  // 支持中英文逗号分割：英文逗号 , 和中文逗号 ，
  const nodes = value.split(/[,，]/).map(s => s.trim()).filter(s => s.length > 0)
  setFilterConfig(prev => ({ ...prev, includeNodes: nodes }))
}

const handleExcludeNodesChange = (value: string) => {
  setExcludeNodesInput(value)
  // 支持中英文逗号分割：英文逗号 , 和中文逗号 ，
  const nodes = value.split(/[,，]/).map(s => s.trim()).filter(s => s.length > 0)
  setFilterConfig(prev => ({ ...prev, excludeNodes: nodes }))
}
```

### 2. 用户界面改进

更新了标签和占位符文本，让用户了解支持中英文逗号：

- **包含节点标签**：`包含节点 (支持中英文逗号分隔)`
- **排除节点标签**：`排除节点 (支持中英文逗号分隔)`
- **包含节点示例**：`例如: 香港, HK，新加坡，SG...`
- **排除节点示例**：`例如: 过期, 测试，备用，Trial...`

## 使用示例

现在用户可以使用以下任意格式输入节点过滤条件：

### 包含节点示例

```
香港,新加坡,美国           # 英文逗号
香港，新加坡，美国         # 中文逗号
香港,新加坡，美国          # 混合使用
HK, SG， US               # 带空格的混合使用
```

### 排除节点示例

```
过期,测试,备用             # 英文逗号
过期，测试，备用           # 中文逗号
过期,测试，备用            # 混合使用
Trial, Test， 备用        # 中英文混合
```

## 功能特性

1. **智能分割**：使用正则表达式 `/[,，]/` 同时识别中英文逗号
2. **空白处理**：自动去除每个节点名称前后的空白字符
3. **空节点过滤**：自动过滤掉空的节点名称
4. **兼容性**：完全向后兼容，现有的英文逗号输入依然正常工作

## 测试验证

已创建测试脚本 `test-node-filter.js` 验证功能正确性，测试覆盖：

- 纯英文逗号分割
- 纯中文逗号分割  
- 中英文逗号混合使用
- 带空格的情况
- 连续逗号的处理
- 边界情况（空字符串、单个节点等）

所有测试用例均通过，功能工作正常。

## 技术实现

使用 JavaScript 正则表达式的字符集 `[,，]` 来匹配两种逗号类型，然后结合 `map()` 和 `filter()` 方法进行数据清理：

```typescript
value.split(/[,，]/)           // 按中英文逗号分割
     .map(s => s.trim())       // 去除空白字符
     .filter(s => s.length > 0) // 过滤空字符串
```

这个改进大大提升了中文用户的使用体验，让节点过滤功能更加人性化。
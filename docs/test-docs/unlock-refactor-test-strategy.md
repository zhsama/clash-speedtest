# è§£é”æ£€æµ‹é‡æ„æµ‹è¯•ç­–ç•¥

## æ¦‚è¿°

æœ¬æ–‡æ¡£ä¸ºclash-speedtesté¡¹ç›®çš„è§£é”æ£€æµ‹åŠŸèƒ½é‡æ„åˆ¶å®šäº†å®Œæ•´çš„æµ‹è¯•å’ŒéªŒè¯ç­–ç•¥ã€‚é‡æ„å°†ç³»ç»Ÿä»æ”¯æŒ6ä¸ªå¹³å°æ‰©å±•åˆ°40+ä¸ªå¹³å°ï¼ŒåŒæ—¶é›†æˆIPé£é™©æ£€æµ‹åŠŸèƒ½ï¼Œç¡®ä¿åœ¨ä¿æŒç°æœ‰æ¶æ„ä¼˜åŠ¿çš„åŒæ—¶æé«˜æ£€æµ‹å‡†ç¡®æ€§ã€‚

## é‡æ„èŒƒå›´åˆ†æ

### å½“å‰çŠ¶æ€

- æ”¯æŒå¹³å°ï¼š6ä¸ªï¼ˆNetflixã€YouTubeã€Disney+ã€ChatGPTã€Spotifyã€Bilibiliï¼‰
- æ¶æ„æ¨¡å¼ï¼šæ¥å£é©±åŠ¨çš„æ£€æµ‹å™¨æ¨¡å¼
- å¹¶å‘æ§åˆ¶ï¼šæ”¯æŒå¹¶å‘æ£€æµ‹å’Œç¼“å­˜æœºåˆ¶
- ä»£ç è´¨é‡ï¼šæ— ç°æœ‰æµ‹è¯•æ–‡ä»¶

### é‡æ„ç›®æ ‡

- å¹³å°æ‰©å±•ï¼šä»6ä¸ªå¹³å°æ‰©å±•åˆ°40+ä¸ªå¹³å°
- æ–°å¢åŠŸèƒ½ï¼šIPé£é™©æ£€æµ‹é›†æˆ
- æ¶æ„ä¿æŒï¼šç»´æŒç°æœ‰UnlockDetectoræ¥å£è®¾è®¡
- æ€§èƒ½æå‡ï¼šä¼˜åŒ–å¹¶å‘æ£€æµ‹æ€§èƒ½
- è´¨é‡æå‡ï¼šå»ºç«‹å®Œæ•´çš„æµ‹è¯•ä½“ç³»

## 1. æµ‹è¯•æ¶æ„è®¾è®¡

### 1.1 åˆ†å±‚æµ‹è¯•æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    E2E æµ‹è¯•å±‚                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚   å‰ç«¯ç•Œé¢æµ‹è¯•   â”‚  â”‚   APIé›†æˆæµ‹è¯•   â”‚  â”‚   ç”¨æˆ·åœºæ™¯æµ‹è¯•   â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   é›†æˆæµ‹è¯•å±‚                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚   ç³»ç»Ÿé›†æˆæµ‹è¯•   â”‚  â”‚   æœåŠ¡é›†æˆæµ‹è¯•   â”‚  â”‚   æ•°æ®æµæµ‹è¯•     â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   å•å…ƒæµ‹è¯•å±‚                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚   æ£€æµ‹å™¨å•å…ƒæµ‹è¯• â”‚  â”‚   å·¥å…·å‡½æ•°æµ‹è¯•   â”‚  â”‚   ç¼“å­˜æœºåˆ¶æµ‹è¯•   â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 1.2 æµ‹è¯•ç»„ä»¶åˆ†è§£

#### 1.2.1 æ ¸å¿ƒç»„ä»¶æµ‹è¯•

- **UnlockDetectoræ¥å£å®ç°**
  - æ¯ä¸ªå¹³å°æ£€æµ‹å™¨çš„ç‹¬ç«‹æµ‹è¯•
  - æ¥å£å¥‘çº¦ä¸€è‡´æ€§éªŒè¯
  - é”™è¯¯å¤„ç†é€»è¾‘æµ‹è¯•

- **BaseDetectorå…¬å…±åŠŸèƒ½**
  - æ—¥å¿—è®°å½•åŠŸèƒ½æµ‹è¯•
  - ç»“æœåˆ›å»ºé€»è¾‘æµ‹è¯•
  - ä¼˜å…ˆçº§å’Œå¹³å°åç§°ç®¡ç†

- **ä¸»æ£€æµ‹å™¨(Detector)**
  - æ£€æµ‹å™¨æ³¨å†Œæœºåˆ¶æµ‹è¯•
  - å¹¶å‘æ§åˆ¶é€»è¾‘æµ‹è¯•
  - ç»“æœèšåˆå’Œæ’åºæµ‹è¯•

#### 1.2.2 æ”¯æŒç»„ä»¶æµ‹è¯•

- **HTTPå®¢æˆ·ç«¯åˆ›å»º**
  - ä»£ç†è¿æ¥å»ºç«‹æµ‹è¯•
  - è¶…æ—¶å’Œé‡å®šå‘å¤„ç†æµ‹è¯•
  - è¯·æ±‚å¤´è®¾ç½®éªŒè¯

- **ç¼“å­˜æœºåˆ¶**
  - ç¼“å­˜å­˜å‚¨å’Œæ£€ç´¢æµ‹è¯•
  - ç¼“å­˜è¿‡æœŸç­–ç•¥æµ‹è¯•
  - å¹¶å‘è®¿é—®å®‰å…¨æµ‹è¯•

- **å·¥å…·å‡½æ•°**
  - User-Agentéšæœºé€‰æ‹©æµ‹è¯•
  - å›½å®¶ä»£ç æå–æµ‹è¯•
  - å“åº”å†…å®¹åˆ†ææµ‹è¯•

### 1.3 æµ‹è¯•æ•°æ®ç®¡ç†

#### 1.3.1 æµ‹è¯•æ•°æ®åˆ†ç±»

- **Mockå“åº”æ•°æ®**
  - å„å¹³å°æˆåŠŸå“åº”ç¤ºä¾‹
  - é”™è¯¯å“åº”åœºæ™¯æ•°æ®
  - è¾¹ç•Œæ¡ä»¶æµ‹è¯•æ•°æ®

- **ä»£ç†é…ç½®æ•°æ®**
  - ä¸åŒç±»å‹ä»£ç†é…ç½®
  - æ— æ•ˆä»£ç†é…ç½®
  - è¶…æ—¶åœºæ™¯é…ç½®

- **IPé£é™©æ•°æ®**
  - ä½é£é™©IPç¤ºä¾‹
  - é«˜é£é™©IPç¤ºä¾‹
  - é£é™©æ£€æµ‹è¾¹ç•Œæ•°æ®

#### 1.3.2 æ•°æ®ç®¡ç†ç­–ç•¥

```go
// æµ‹è¯•æ•°æ®ç®¡ç†ç»“æ„
type TestDataManager struct {
    MockResponses map[string][]MockResponse
    ProxyConfigs  map[string]ProxyConfig
    IPRiskData    map[string]IPRiskInfo
}

type MockResponse struct {
    Platform    string
    Status      int
    Body        string
    Headers     map[string]string
    Scenario    string // "success", "blocked", "error", "timeout"
}
```

## 2. æµ‹è¯•ç”¨ä¾‹è®¾è®¡

### 2.1 å•å…ƒæµ‹è¯•ç”¨ä¾‹

#### 2.1.1 æ£€æµ‹å™¨å•å…ƒæµ‹è¯•æ¨¡æ¿

```go
// æ¯ä¸ªå¹³å°æ£€æµ‹å™¨éœ€è¦å®ç°çš„æ ‡å‡†æµ‹è¯•ç”¨ä¾‹
func TestPlatformDetector(t *testing.T) {
    detector := NewPlatformDetector()
    
    testCases := []struct {
        name           string
        mockResponse   MockResponse
        expectedStatus UnlockStatus
        expectedRegion string
        expectedError  bool
    }{
        {
            name: "æˆåŠŸè§£é”_ç¾å›½åœ°åŒº",
            mockResponse: MockResponse{
                Status: 200,
                Body:   getSuccessResponse("US"),
            },
            expectedStatus: StatusUnlocked,
            expectedRegion: "US",
            expectedError:  false,
        },
        {
            name: "åœ°åŒºå°é”",
            mockResponse: MockResponse{
                Status: 200,
                Body:   getBlockedResponse(),
            },
            expectedStatus: StatusLocked,
            expectedRegion: "",
            expectedError:  false,
        },
        {
            name: "ç½‘ç»œè¶…æ—¶",
            mockResponse: MockResponse{
                Status: 0,
                Body:   "",
                Error:  errors.New("timeout"),
            },
            expectedStatus: StatusError,
            expectedRegion: "",
            expectedError:  true,
        },
        {
            name: "æœåŠ¡å™¨é”™è¯¯",
            mockResponse: MockResponse{
                Status: 500,
                Body:   "Internal Server Error",
            },
            expectedStatus: StatusFailed,
            expectedRegion: "",
            expectedError:  false,
        },
    }
    
    for _, tc := range testCases {
        t.Run(tc.name, func(t *testing.T) {
            // è®¾ç½®Mock
            // æ‰§è¡Œæµ‹è¯•
            // éªŒè¯ç»“æœ
        })
    }
}
```

#### 2.1.2 æ ¸å¿ƒåŠŸèƒ½æµ‹è¯•ç”¨ä¾‹

```go
// å¹¶å‘æ§åˆ¶æµ‹è¯•
func TestConcurrencyController(t *testing.T) {
    controller := NewConcurrencyController(3)
    
    // æµ‹è¯•å¹¶å‘é™åˆ¶
    // æµ‹è¯•ä¿¡å·é‡è·å–å’Œé‡Šæ”¾
    // æµ‹è¯•ç«æ€æ¡ä»¶
}

// ç¼“å­˜æœºåˆ¶æµ‹è¯•
func TestUnlockCache(t *testing.T) {
    cache := NewUnlockCache()
    
    // æµ‹è¯•ç¼“å­˜å­˜å‚¨å’Œæ£€ç´¢
    // æµ‹è¯•ç¼“å­˜è¿‡æœŸ
    // æµ‹è¯•å¹¶å‘è®¿é—®å®‰å…¨
}

// ä¸»æ£€æµ‹å™¨æµ‹è¯•
func TestDetector(t *testing.T) {
    detector := NewDetector(DefaultUnlockConfig())
    
    // æµ‹è¯•æ£€æµ‹å™¨æ³¨å†Œ
    // æµ‹è¯•å¹¶å‘æ£€æµ‹
    // æµ‹è¯•ç»“æœèšåˆ
    // æµ‹è¯•ä¼˜å…ˆçº§æ’åº
}
```

### 2.2 é›†æˆæµ‹è¯•ç”¨ä¾‹

#### 2.2.1 ç³»ç»Ÿé›†æˆæµ‹è¯•

```go
// å®Œæ•´æ£€æµ‹æµç¨‹æµ‹è¯•
func TestUnlockDetectionFlow(t *testing.T) {
    // è®¾ç½®æµ‹è¯•ç¯å¢ƒ
    // æ¨¡æ‹Ÿä»£ç†è¿æ¥
    // æ‰§è¡Œå®Œæ•´æ£€æµ‹æµç¨‹
    // éªŒè¯ç»“æœæ ¼å¼å’Œå†…å®¹
}

// å¤šå¹³å°å¹¶å‘æ£€æµ‹æµ‹è¯•
func TestMultiPlatformConcurrentDetection(t *testing.T) {
    // è®¾ç½®å¤šä¸ªå¹³å°æ£€æµ‹å™¨
    // æ¨¡æ‹Ÿå¹¶å‘æ£€æµ‹åœºæ™¯
    // éªŒè¯ç»“æœä¸€è‡´æ€§
    // éªŒè¯æ€§èƒ½æŒ‡æ ‡
}
```

#### 2.2.2 IPé£é™©æ£€æµ‹é›†æˆæµ‹è¯•

```go
// IPé£é™©æ£€æµ‹é›†æˆæµ‹è¯•
func TestIPRiskDetectionIntegration(t *testing.T) {
    // æµ‹è¯•IPé£é™©æ£€æµ‹APIè°ƒç”¨
    // æµ‹è¯•é£é™©è¯„åˆ†è®¡ç®—
    // æµ‹è¯•é£é™©ç»“æœä¸è§£é”ç»“æœçš„å…³è”
}
```

### 2.3 ç«¯åˆ°ç«¯æµ‹è¯•ç”¨ä¾‹

#### 2.3.1 ç”¨æˆ·åœºæ™¯æµ‹è¯•

```go
// å…¸å‹ç”¨æˆ·ä½¿ç”¨åœºæ™¯æµ‹è¯•
func TestTypicalUserScenarios(t *testing.T) {
    scenarios := []struct {
        name        string
        proxyConfig ProxyConfig
        platforms   []string
        expected    []UnlockResult
    }{
        {
            name: "ç¾å›½ä»£ç†_æµåª’ä½“æ£€æµ‹",
            proxyConfig: getUSProxyConfig(),
            platforms: []string{"Netflix", "Disney+", "Hulu"},
            expected: []UnlockResult{
                {Platform: "Netflix", Status: StatusUnlocked, Region: "US"},
                {Platform: "Disney+", Status: StatusUnlocked, Region: "US"},
                {Platform: "Hulu", Status: StatusUnlocked, Region: "US"},
            },
        },
        // æ›´å¤šåœºæ™¯...
    }
}
```

#### 2.3.2 å‰ç«¯ç•Œé¢æµ‹è¯•

```javascript
// ä½¿ç”¨Playwrightæˆ–Cypressè¿›è¡ŒE2Eæµ‹è¯•
describe('è§£é”æ£€æµ‹å‰ç«¯æµ‹è¯•', () => {
    test('æ£€æµ‹ç»“æœå®æ—¶æ˜¾ç¤º', async () => {
        // å¯åŠ¨æ£€æµ‹
        // éªŒè¯è¿›åº¦æ˜¾ç¤º
        // éªŒè¯ç»“æœå±•ç¤º
        // éªŒè¯äº¤äº’åŠŸèƒ½
    });
    
    test('é…ç½®ç®¡ç†ç•Œé¢', async () => {
        // æµ‹è¯•å¹³å°é€‰æ‹©
        // æµ‹è¯•å‚æ•°é…ç½®
        // æµ‹è¯•é…ç½®ä¿å­˜
    });
});
```

### 2.4 æ€§èƒ½æµ‹è¯•ç”¨ä¾‹

#### 2.4.1 å¹¶å‘æ€§èƒ½æµ‹è¯•

```go
func TestConcurrentDetectionPerformance(t *testing.T) {
    // æµ‹è¯•ä¸åŒå¹¶å‘çº§åˆ«çš„æ€§èƒ½
    // æµ‹é‡æ£€æµ‹å»¶è¿Ÿ
    // æµ‹é‡å†…å­˜ä½¿ç”¨
    // æµ‹é‡CPUä½¿ç”¨ç‡
}
```

#### 2.4.2 å¤§è§„æ¨¡å¹³å°æµ‹è¯•

```go
func TestLargeScalePlatformDetection(t *testing.T) {
    // æµ‹è¯•40+ä¸ªå¹³å°çš„å¹¶å‘æ£€æµ‹
    // æµ‹é‡æ€»ä½“æ£€æµ‹æ—¶é—´
    // éªŒè¯ç³»ç»Ÿèµ„æºæ¶ˆè€—
}
```

## 3. æµ‹è¯•å·¥å…·é€‰æ‹©

### 3.1 Goåç«¯æµ‹è¯•å·¥å…·

#### 3.1.1 åŸºç¡€æµ‹è¯•æ¡†æ¶

- **æ ‡å‡†åº“testing**
  - ç”¨é€”ï¼šåŸºç¡€å•å…ƒæµ‹è¯•
  - ä¼˜åŠ¿ï¼šå†…ç½®æ”¯æŒï¼Œæ— é¢å¤–ä¾èµ–
  - é€‚ç”¨åœºæ™¯ï¼šæ‰€æœ‰å•å…ƒæµ‹è¯•

- **testify/suite**
  - ç”¨é€”ï¼šæµ‹è¯•å¥—ä»¶ç»„ç»‡
  - ä¼˜åŠ¿ï¼šä¸°å¯Œçš„æ–­è¨€åº“ï¼Œæµ‹è¯•å¥—ä»¶ç®¡ç†
  - é€‚ç”¨åœºæ™¯ï¼šå¤æ‚çš„æµ‹è¯•åœºæ™¯ç»„ç»‡

#### 3.1.2 Mockå’Œå­˜æ ¹å·¥å…·

- **gomock**
  - ç”¨é€”ï¼šæ¥å£Mockç”Ÿæˆ
  - ä¼˜åŠ¿ï¼šä»£ç ç”Ÿæˆï¼Œç±»å‹å®‰å…¨
  - é€‚ç”¨åœºæ™¯ï¼šUnlockDetectoræ¥å£æµ‹è¯•

- **httptest**
  - ç”¨é€”ï¼šHTTPæœåŠ¡Mock
  - ä¼˜åŠ¿ï¼šæ ‡å‡†åº“å†…ç½®
  - é€‚ç”¨åœºæ™¯ï¼šå¹³å°APIå“åº”æ¨¡æ‹Ÿ

- **gock**
  - ç”¨é€”ï¼šHTTPè¯·æ±‚æ‹¦æˆªå’ŒMock
  - ä¼˜åŠ¿ï¼šçµæ´»çš„è¯·æ±‚åŒ¹é…
  - é€‚ç”¨åœºæ™¯ï¼šå¤–éƒ¨APIè°ƒç”¨æµ‹è¯•

#### 3.1.3 æ€§èƒ½æµ‹è¯•å·¥å…·

- **Go benchmark**
  - ç”¨é€”ï¼šæ€§èƒ½åŸºå‡†æµ‹è¯•
  - ä¼˜åŠ¿ï¼šå†…ç½®æ”¯æŒï¼Œè¯¦ç»†æ€§èƒ½æŒ‡æ ‡
  - é€‚ç”¨åœºæ™¯ï¼šæ£€æµ‹å™¨æ€§èƒ½æµ‹è¯•

- **pprof**
  - ç”¨é€”ï¼šæ€§èƒ½åˆ†æ
  - ä¼˜åŠ¿ï¼šæ·±åº¦æ€§èƒ½å‰–æ
  - é€‚ç”¨åœºæ™¯ï¼šæ€§èƒ½ç“¶é¢ˆåˆ†æ

### 3.2 å‰ç«¯æµ‹è¯•å·¥å…·

#### 3.2.1 å•å…ƒæµ‹è¯•æ¡†æ¶

- **Vitest**
  - ç”¨é€”ï¼šReactç»„ä»¶å•å…ƒæµ‹è¯•
  - ä¼˜åŠ¿ï¼šå¿«é€Ÿï¼Œä¸Viteç”Ÿæ€é›†æˆ
  - é€‚ç”¨åœºæ™¯ï¼šç»„ä»¶é€»è¾‘æµ‹è¯•

- **React Testing Library**
  - ç”¨é€”ï¼šReactç»„ä»¶æµ‹è¯•
  - ä¼˜åŠ¿ï¼šç”¨æˆ·è¡Œä¸ºé©±åŠ¨æµ‹è¯•
  - é€‚ç”¨åœºæ™¯ï¼šUIäº¤äº’æµ‹è¯•

#### 3.2.2 ç«¯åˆ°ç«¯æµ‹è¯•å·¥å…·

- **Playwright**
  - ç”¨é€”ï¼šæµè§ˆå™¨è‡ªåŠ¨åŒ–æµ‹è¯•
  - ä¼˜åŠ¿ï¼šè·¨æµè§ˆå™¨æ”¯æŒï¼Œå¼ºå¤§çš„API
  - é€‚ç”¨åœºæ™¯ï¼šå®Œæ•´ç”¨æˆ·æµç¨‹æµ‹è¯•

- **Cypress**
  - ç”¨é€”ï¼šå‰ç«¯E2Eæµ‹è¯•
  - ä¼˜åŠ¿ï¼šå®æ—¶è°ƒè¯•ï¼Œä¸°å¯Œçš„æ–­è¨€
  - é€‚ç”¨åœºæ™¯ï¼šç”¨æˆ·ç•Œé¢æµ‹è¯•

### 3.3 é›†æˆæµ‹è¯•å·¥å…·

#### 3.3.1 APIæµ‹è¯•å·¥å…·

- **Postman/Newman**
  - ç”¨é€”ï¼šAPIé›†æˆæµ‹è¯•
  - ä¼˜åŠ¿ï¼šå¯è§†åŒ–æµ‹è¯•ï¼ŒCI/CDé›†æˆ
  - é€‚ç”¨åœºæ™¯ï¼šAPIæ¥å£æµ‹è¯•

- **REST Assured (Goç‰ˆæœ¬)**
  - ç”¨é€”ï¼šREST APIæµ‹è¯•
  - ä¼˜åŠ¿ï¼šæµç•…çš„APIæµ‹è¯•è¯­æ³•
  - é€‚ç”¨åœºæ™¯ï¼šWebSocket APIæµ‹è¯•

#### 3.3.2 æ•°æ®åº“æµ‹è¯•å·¥å…·

- **testcontainers-go**
  - ç”¨é€”ï¼šæ•°æ®åº“é›†æˆæµ‹è¯•
  - ä¼˜åŠ¿ï¼šçœŸå®æ•°æ®åº“ç¯å¢ƒ
  - é€‚ç”¨åœºæ™¯ï¼šç¼“å­˜æ•°æ®åº“æµ‹è¯•

### 3.4 CI/CDæµ‹è¯•å·¥å…·

#### 3.4.1 æŒç»­é›†æˆ

- **GitHub Actions**
  - ç”¨é€”ï¼šè‡ªåŠ¨åŒ–æµ‹è¯•æµæ°´çº¿
  - ä¼˜åŠ¿ï¼šä¸GitHubæ·±åº¦é›†æˆ
  - é€‚ç”¨åœºæ™¯ï¼šä»£ç æäº¤è§¦å‘æµ‹è¯•

- **Docker**
  - ç”¨é€”ï¼šæµ‹è¯•ç¯å¢ƒæ ‡å‡†åŒ–
  - ä¼˜åŠ¿ï¼šç¯å¢ƒä¸€è‡´æ€§
  - é€‚ç”¨åœºæ™¯ï¼šè·¨å¹³å°æµ‹è¯•

#### 3.4.2 ä»£ç è´¨é‡å·¥å…·

- **golangci-lint**
  - ç”¨é€”ï¼šGoä»£ç è´¨é‡æ£€æŸ¥
  - ä¼˜åŠ¿ï¼šé›†æˆå¤šç§linter
  - é€‚ç”¨åœºæ™¯ï¼šä»£ç è´¨é‡ä¿éšœ

- **SonarQube**
  - ç”¨é€”ï¼šä»£ç è´¨é‡åˆ†æ
  - ä¼˜åŠ¿ï¼šè¯¦ç»†çš„è´¨é‡æŠ¥å‘Š
  - é€‚ç”¨åœºæ™¯ï¼šä»£ç è´¨é‡åº¦é‡

## 4. æµ‹è¯•ç¯å¢ƒæ­å»º

### 4.1 æœ¬åœ°å¼€å‘ç¯å¢ƒ

#### 4.1.1 Goåç«¯æµ‹è¯•ç¯å¢ƒ

```bash
# åŸºç¡€ç¯å¢ƒè¦æ±‚
GO_VERSION=1.21+
GOLANGCI_LINT_VERSION=1.54+

# æµ‹è¯•ä¾èµ–å®‰è£…
go install github.com/golang/mock/mockgen@latest
go install github.com/onsi/ginkgo/v2/ginkgo@latest
go install github.com/onsi/gomega@latest

# é¡¹ç›®ä¾èµ–
go mod tidy
```

#### 4.1.2 å‰ç«¯æµ‹è¯•ç¯å¢ƒ

```bash
# Node.jsç¯å¢ƒ
NODE_VERSION=18+
NPM_VERSION=9+

# æµ‹è¯•æ¡†æ¶å®‰è£…
npm install -D vitest @testing-library/react @testing-library/jest-dom
npm install -D playwright @playwright/test
npm install -D cypress
```

#### 4.1.3 MockæœåŠ¡æ­å»º

```yaml
# docker-compose.test.yml
version: '3.8'
services:
  mock-server:
    image: mockserver/mockserver:latest
    ports:
      - "1080:1080"
    environment:
      MOCKSERVER_PROPERTY_FILE: /config/mockserver.properties
    volumes:
      - ./test/mock-config:/config
      
  redis-test:
    image: redis:7-alpine
    ports:
      - "6380:6379"
    command: redis-server --appendonly yes
```

### 4.2 CI/CDç¯å¢ƒ

#### 4.2.1 GitHub Actionsé…ç½®

```yaml
# .github/workflows/test.yml
name: Test Suite

on:
  push:
    branches: [ main, develop ]
  pull_request:
    branches: [ main ]

jobs:
  backend-test:
    runs-on: ubuntu-latest
    strategy:
      matrix:
        go-version: [1.21, 1.22]
    
    steps:
    - uses: actions/checkout@v3
    
    - name: Set up Go
      uses: actions/setup-go@v4
      with:
        go-version: ${{ matrix.go-version }}
    
    - name: Install dependencies
      run: |
        cd backend
        go mod tidy
        go install github.com/golang/mock/mockgen@latest
    
    - name: Run unit tests
      run: |
        cd backend
        go test -v -race -coverprofile=coverage.out ./...
    
    - name: Run integration tests
      run: |
        cd backend
        go test -v -tags=integration ./...
    
    - name: Upload coverage
      uses: codecov/codecov-action@v3
      with:
        file: ./backend/coverage.out

  frontend-test:
    runs-on: ubuntu-latest
    
    steps:
    - uses: actions/checkout@v3
    
    - name: Set up Node.js
      uses: actions/setup-node@v3
      with:
        node-version: '18'
        cache: 'npm'
        cache-dependency-path: frontend/package-lock.json
    
    - name: Install dependencies
      run: |
        cd frontend
        npm ci
    
    - name: Run unit tests
      run: |
        cd frontend
        npm run test:unit
    
    - name: Run E2E tests
      run: |
        cd frontend
        npm run test:e2e
```

#### 4.2.2 æµ‹è¯•ç¯å¢ƒéš”ç¦»

```bash
# æµ‹è¯•ç¯å¢ƒè„šæœ¬
#!/bin/bash
# setup-test-env.sh

# å¯åŠ¨æµ‹è¯•ä¾èµ–æœåŠ¡
docker-compose -f docker-compose.test.yml up -d

# ç­‰å¾…æœåŠ¡å¯åŠ¨
./scripts/wait-for-services.sh

# åˆå§‹åŒ–æµ‹è¯•æ•°æ®
./scripts/init-test-data.sh

# è¿è¡Œæµ‹è¯•
go test -v ./...

# æ¸…ç†æµ‹è¯•ç¯å¢ƒ
docker-compose -f docker-compose.test.yml down
```

### 4.3 æµ‹è¯•æ•°æ®å‡†å¤‡

#### 4.3.1 Mockå“åº”æ•°æ®

```go
// test/testdata/mock_responses.go
package testdata

var NetflixResponses = map[string]string{
    "us_success": `{
        "requestCountry": "US",
        "title": "Stranger Things",
        "available": true
    }`,
    "blocked": `{
        "error": "NSEZ-403",
        "message": "Not Available"
    }`,
    "timeout": "", // ç©ºå“åº”æ¨¡æ‹Ÿè¶…æ—¶
}

var DisneyResponses = map[string]string{
    "us_success": `{
        "region": "US",
        "content": "available"
    }`,
    // æ›´å¤šå“åº”...
}
```

#### 4.3.2 æµ‹è¯•é…ç½®æ•°æ®

```yaml
# test/testdata/test_config.yaml
test_proxies:
  - name: "test-us-proxy"
    type: "http"
    server: "127.0.0.1"
    port: 8080
    region: "US"
    
  - name: "test-jp-proxy"
    type: "http"
    server: "127.0.0.1"
    port: 8081
    region: "JP"

platforms:
  - name: "Netflix"
    priority: 1
    timeout: 10
    expected_regions: ["US", "JP", "GB"]
    
  - name: "Disney+"
    priority: 1
    timeout: 10
    expected_regions: ["US", "JP", "GB"]
```

## 5. æµ‹è¯•æ‰§è¡Œè®¡åˆ’

### 5.1 æµ‹è¯•é˜¶æ®µè§„åˆ’

#### 5.1.1 ç¬¬ä¸€é˜¶æ®µï¼šåŸºç¡€æµ‹è¯•å»ºè®¾ï¼ˆ2å‘¨ï¼‰

**ç›®æ ‡**ï¼šå»ºç«‹åŸºç¡€æµ‹è¯•æ¡†æ¶å’Œæ ¸å¿ƒç»„ä»¶æµ‹è¯•

**ä»»åŠ¡æ¸…å•**ï¼š

- [ ] æ­å»ºGoåç«¯æµ‹è¯•ç¯å¢ƒ
- [ ] å®ç°BaseDetectoræµ‹è¯•å¥—ä»¶
- [ ] åˆ›å»ºHTTPå®¢æˆ·ç«¯æµ‹è¯•
- [ ] å®ç°ç¼“å­˜æœºåˆ¶æµ‹è¯•
- [ ] å»ºç«‹MockæœåŠ¡åŸºç¡€è®¾æ–½

**äº¤ä»˜ç‰©**ï¼š

- åŸºç¡€æµ‹è¯•æ¡†æ¶
- æ ¸å¿ƒç»„ä»¶æµ‹è¯•ç”¨ä¾‹
- MockæœåŠ¡é…ç½®
- æµ‹è¯•æ•°æ®ç®¡ç†ç³»ç»Ÿ

#### 5.1.2 ç¬¬äºŒé˜¶æ®µï¼šå¹³å°æ£€æµ‹å™¨æµ‹è¯•ï¼ˆ3å‘¨ï¼‰

**ç›®æ ‡**ï¼šä¸ºæ‰€æœ‰40+ä¸ªå¹³å°å»ºç«‹æ£€æµ‹å™¨æµ‹è¯•

**ä»»åŠ¡æ¸…å•**ï¼š

- [ ] å®ç°ç°æœ‰6ä¸ªå¹³å°çš„å®Œæ•´æµ‹è¯•
- [ ] ä¸ºæ–°å¢34ä¸ªå¹³å°åˆ›å»ºæµ‹è¯•ç”¨ä¾‹
- [ ] å»ºç«‹å¹³å°æ£€æµ‹å™¨æµ‹è¯•æ¨¡æ¿
- [ ] å®ç°æ£€æµ‹å™¨å·¥å‚æµ‹è¯•
- [ ] åˆ›å»ºå¹³å°å“åº”æ•°æ®åº“

**äº¤ä»˜ç‰©**ï¼š

- æ‰€æœ‰å¹³å°æ£€æµ‹å™¨æµ‹è¯•
- æµ‹è¯•ç”¨ä¾‹æ¨¡æ¿
- å¹³å°å“åº”æ•°æ®åº“
- æ£€æµ‹å™¨æ€§èƒ½åŸºå‡†

#### 5.1.3 ç¬¬ä¸‰é˜¶æ®µï¼šé›†æˆæµ‹è¯•å¼€å‘ï¼ˆ2å‘¨ï¼‰

**ç›®æ ‡**ï¼šå»ºç«‹ç³»ç»Ÿé›†æˆæµ‹è¯•å’Œæ€§èƒ½æµ‹è¯•

**ä»»åŠ¡æ¸…å•**ï¼š

- [ ] å®ç°ä¸»æ£€æµ‹å™¨é›†æˆæµ‹è¯•
- [ ] å»ºç«‹å¹¶å‘æ£€æµ‹æµ‹è¯•
- [ ] åˆ›å»ºIPé£é™©æ£€æµ‹é›†æˆæµ‹è¯•
- [ ] å®ç°ç¼“å­˜é›†æˆæµ‹è¯•
- [ ] å»ºç«‹æ€§èƒ½æµ‹è¯•å¥—ä»¶

**äº¤ä»˜ç‰©**ï¼š

- é›†æˆæµ‹è¯•å¥—ä»¶
- æ€§èƒ½æµ‹è¯•åŸºå‡†
- å¹¶å‘å®‰å…¨æµ‹è¯•
- ç³»ç»Ÿèµ„æºç›‘æ§

#### 5.1.4 ç¬¬å››é˜¶æ®µï¼šå‰ç«¯å’ŒE2Eæµ‹è¯•ï¼ˆ2å‘¨ï¼‰

**ç›®æ ‡**ï¼šå»ºç«‹å‰ç«¯æµ‹è¯•å’Œç«¯åˆ°ç«¯æµ‹è¯•

**ä»»åŠ¡æ¸…å•**ï¼š

- [ ] å®ç°Reactç»„ä»¶å•å…ƒæµ‹è¯•
- [ ] å»ºç«‹WebSocketè¿æ¥æµ‹è¯•
- [ ] åˆ›å»ºç”¨æˆ·ç•Œé¢E2Eæµ‹è¯•
- [ ] å®ç°APIé›†æˆæµ‹è¯•
- [ ] å»ºç«‹ç”¨æˆ·åœºæ™¯æµ‹è¯•

**äº¤ä»˜ç‰©**ï¼š

- å‰ç«¯æµ‹è¯•å¥—ä»¶
- E2Eæµ‹è¯•åœºæ™¯
- APIé›†æˆæµ‹è¯•
- ç”¨æˆ·ä½“éªŒæµ‹è¯•

#### 5.1.5 ç¬¬äº”é˜¶æ®µï¼šCI/CDé›†æˆï¼ˆ1å‘¨ï¼‰

**ç›®æ ‡**ï¼šå»ºç«‹è‡ªåŠ¨åŒ–æµ‹è¯•æµæ°´çº¿

**ä»»åŠ¡æ¸…å•**ï¼š

- [ ] é…ç½®GitHub Actions
- [ ] å»ºç«‹æµ‹è¯•ç¯å¢ƒè‡ªåŠ¨åŒ–
- [ ] å®ç°ä»£ç è¦†ç›–ç‡æŠ¥å‘Š
- [ ] é…ç½®è´¨é‡é—¨ç¦
- [ ] å»ºç«‹æµ‹è¯•æŠ¥å‘Šç³»ç»Ÿ

**äº¤ä»˜ç‰©**ï¼š

- CI/CDé…ç½®
- è‡ªåŠ¨åŒ–æµ‹è¯•æµæ°´çº¿
- è´¨é‡æŠ¥å‘Šç³»ç»Ÿ
- æµ‹è¯•æŒ‡æ ‡ç›‘æ§

### 5.2 æµ‹è¯•æ‰§è¡Œç­–ç•¥

#### 5.2.1 æµ‹è¯•ä¼˜å…ˆçº§åˆ†ç±»

**P0 - å…³é”®æµ‹è¯•**ï¼š

- æ‰€æœ‰å¹³å°æ£€æµ‹å™¨æ ¸å¿ƒåŠŸèƒ½
- ä¸»æ£€æµ‹å™¨å¹¶å‘æ§åˆ¶
- ç¼“å­˜æœºåˆ¶åŸºç¡€åŠŸèƒ½
- é”™è¯¯å¤„ç†å’Œæ¢å¤

**P1 - é‡è¦æµ‹è¯•**ï¼š

- IPé£é™©æ£€æµ‹é›†æˆ
- æ€§èƒ½åŸºå‡†æµ‹è¯•
- ç”¨æˆ·ç•Œé¢äº¤äº’
- APIé›†æˆæµ‹è¯•

**P2 - ä¸€èˆ¬æµ‹è¯•**ï¼š

- è¾¹ç•Œæ¡ä»¶æµ‹è¯•
- å‹åŠ›æµ‹è¯•
- å…¼å®¹æ€§æµ‹è¯•
- æ–‡æ¡£æµ‹è¯•

#### 5.2.2 æµ‹è¯•æ‰§è¡Œé¢‘ç‡

**æ¯æ¬¡æäº¤**ï¼š

- å•å…ƒæµ‹è¯•ï¼ˆP0ï¼‰
- å¿«é€Ÿé›†æˆæµ‹è¯•
- ä»£ç è´¨é‡æ£€æŸ¥
- å®‰å…¨æ‰«æ

**æ¯æ—¥æ„å»º**ï¼š

- å®Œæ•´æµ‹è¯•å¥—ä»¶
- æ€§èƒ½åŸºå‡†æµ‹è¯•
- é›†æˆæµ‹è¯•
- E2Eæµ‹è¯•

**æ¯å‘¨æ„å»º**ï¼š

- å‹åŠ›æµ‹è¯•
- é•¿æœŸè¿è¡Œæµ‹è¯•
- å…¼å®¹æ€§æµ‹è¯•
- å®‰å…¨æµ‹è¯•

### 5.3 æµ‹è¯•æ•°æ®ç®¡ç†

#### 5.3.1 æµ‹è¯•æ•°æ®ç”Ÿå‘½å‘¨æœŸ

```go
// æµ‹è¯•æ•°æ®ç®¡ç†å™¨
type TestDataManager struct {
    dataDir     string
    mockServer  *httptest.Server
    cleanupFns  []func()
}

func (tm *TestDataManager) SetupTestData() error {
    // åˆå§‹åŒ–MockæœåŠ¡
    // åŠ è½½æµ‹è¯•æ•°æ®
    // å¯åŠ¨ä¾èµ–æœåŠ¡
    return nil
}

func (tm *TestDataManager) CleanupTestData() error {
    // æ‰§è¡Œæ¸…ç†å‡½æ•°
    // å…³é—­MockæœåŠ¡
    // æ¸…ç†ä¸´æ—¶æ•°æ®
    return nil
}
```

#### 5.3.2 æµ‹è¯•ç¯å¢ƒç®¡ç†

```bash
# æµ‹è¯•ç¯å¢ƒè„šæœ¬
#!/bin/bash

# ç¯å¢ƒè®¾ç½®
export TEST_ENV=true
export MOCK_SERVER_URL="http://localhost:1080"
export REDIS_TEST_URL="redis://localhost:6380"

# å¯åŠ¨æµ‹è¯•ç¯å¢ƒ
start_test_env() {
    echo "Starting test environment..."
    docker-compose -f docker-compose.test.yml up -d
    ./scripts/wait-for-services.sh
    ./scripts/init-test-data.sh
}

# åœæ­¢æµ‹è¯•ç¯å¢ƒ
stop_test_env() {
    echo "Stopping test environment..."
    docker-compose -f docker-compose.test.yml down
    ./scripts/cleanup-test-data.sh
}

# é‡ç½®æµ‹è¯•ç¯å¢ƒ
reset_test_env() {
    stop_test_env
    start_test_env
}
```

## 6. è´¨é‡ä¿éšœæªæ–½

### 6.1 ä»£ç è´¨é‡æ ‡å‡†

#### 6.1.1 æµ‹è¯•è¦†ç›–ç‡è¦æ±‚

- **å•å…ƒæµ‹è¯•è¦†ç›–ç‡**ï¼š>= 85%
- **é›†æˆæµ‹è¯•è¦†ç›–ç‡**ï¼š>= 70%
- **å…³é”®è·¯å¾„è¦†ç›–ç‡**ï¼š>= 95%
- **æ–°ä»£ç è¦†ç›–ç‡**ï¼š>= 90%

#### 6.1.2 ä»£ç è´¨é‡æ£€æŸ¥

```yaml
# .golangci.yml
linters-settings:
  govet:
    check-shadowing: true
  golint:
    min-confidence: 0.8
  gocyclo:
    min-complexity: 10
  maligned:
    suggest-new: true
  dupl:
    threshold: 100
  goconst:
    min-len: 2
    min-occurrences: 2

linters:
  enable:
    - bodyclose
    - deadcode
    - depguard
    - dogsled
    - dupl
    - errcheck
    - gochecknoinits
    - goconst
    - gocyclo
    - gofmt
    - goimports
    - golint
    - gomnd
    - goprintffuncname
    - gosec
    - gosimple
    - govet
    - ineffassign
    - interfacer
    - lll
    - misspell
    - nakedret
    - rowserrcheck
    - scopelint
    - staticcheck
    - structcheck
    - stylecheck
    - typecheck
    - unconvert
    - unparam
    - unused
    - varcheck
    - whitespace
```

### 6.2 æ€§èƒ½è´¨é‡ä¿éšœ

#### 6.2.1 æ€§èƒ½åŸºå‡†è®¾å®š

```go
// æ€§èƒ½åŸºå‡†æµ‹è¯•
func BenchmarkUnlockDetection(b *testing.B) {
    detector := NewDetector(DefaultUnlockConfig())
    proxy := createTestProxy()
    
    b.ResetTimer()
    for i := 0; i < b.N; i++ {
        results := detector.DetectAll(proxy, []string{"Netflix", "Disney+"})
        if len(results) == 0 {
            b.Fatal("No results returned")
        }
    }
}

// æ€§èƒ½è¦æ±‚
const (
    MaxDetectionTime = 30 * time.Second  // æœ€å¤§æ£€æµ‹æ—¶é—´
    MaxMemoryUsage   = 100 * 1024 * 1024 // æœ€å¤§å†…å­˜ä½¿ç”¨ï¼š100MB
    MaxCPUUsage      = 80                // æœ€å¤§CPUä½¿ç”¨ç‡ï¼š80%
)
```

#### 6.2.2 æ€§èƒ½ç›‘æ§

```go
// æ€§èƒ½ç›‘æ§ä¸­é—´ä»¶
type PerformanceMonitor struct {
    metrics map[string]PerformanceMetric
    mu      sync.RWMutex
}

type PerformanceMetric struct {
    Duration    time.Duration
    MemoryUsage int64
    CPUUsage    float64
    Timestamp   time.Time
}

func (pm *PerformanceMonitor) RecordMetric(name string, metric PerformanceMetric) {
    pm.mu.Lock()
    defer pm.mu.Unlock()
    pm.metrics[name] = metric
}
```

### 6.3 å®‰å…¨è´¨é‡ä¿éšœ

#### 6.3.1 å®‰å…¨æµ‹è¯•è¦æ±‚

- **ä¾èµ–å®‰å…¨æ‰«æ**ï¼šä½¿ç”¨ `go mod audit` å’Œ `snyk`
- **ä»£ç å®‰å…¨æ£€æŸ¥**ï¼šä½¿ç”¨ `gosec` è¿›è¡Œå®‰å…¨æ¼æ´æ£€æŸ¥
- **ç½‘ç»œå®‰å…¨æµ‹è¯•**ï¼šéªŒè¯ä»£ç†è¿æ¥å®‰å…¨æ€§
- **æ•°æ®å®‰å…¨æµ‹è¯•**ï¼šç¡®ä¿æ•æ„Ÿæ•°æ®ä¸è¢«æ³„éœ²

#### 6.3.2 å®‰å…¨æµ‹è¯•å®ç°

```go
// å®‰å…¨æµ‹è¯•ç¤ºä¾‹
func TestSecurityVulnerabilities(t *testing.T) {
    // æµ‹è¯•SQLæ³¨å…¥é˜²æŠ¤
    // æµ‹è¯•XSSé˜²æŠ¤
    // æµ‹è¯•CSRFé˜²æŠ¤
    // æµ‹è¯•æƒé™éªŒè¯
}

func TestDataSecurity(t *testing.T) {
    // æµ‹è¯•æ•æ„Ÿæ•°æ®å¤„ç†
    // æµ‹è¯•æ—¥å¿—å®‰å…¨
    // æµ‹è¯•é…ç½®æ–‡ä»¶å®‰å…¨
    // æµ‹è¯•ç½‘ç»œä¼ è¾“å®‰å…¨
}
```

### 6.4 å¯é æ€§ä¿éšœ

#### 6.4.1 é”™è¯¯å¤„ç†æµ‹è¯•

```go
// é”™è¯¯å¤„ç†æµ‹è¯•
func TestErrorHandling(t *testing.T) {
    testCases := []struct {
        name          string
        scenario      ErrorScenario
        expectedError bool
        expectedRetry bool
    }{
        {
            name:          "ç½‘ç»œè¿æ¥å¤±è´¥",
            scenario:      NetworkError,
            expectedError: true,
            expectedRetry: true,
        },
        {
            name:          "è¶…æ—¶é”™è¯¯",
            scenario:      TimeoutError,
            expectedError: true,
            expectedRetry: true,
        },
        {
            name:          "æœåŠ¡ä¸å¯ç”¨",
            scenario:      ServiceUnavailable,
            expectedError: true,
            expectedRetry: false,
        },
    }
    
    for _, tc := range testCases {
        t.Run(tc.name, func(t *testing.T) {
            // æ¨¡æ‹Ÿé”™è¯¯åœºæ™¯
            // éªŒè¯é”™è¯¯å¤„ç†é€»è¾‘
            // éªŒè¯é‡è¯•æœºåˆ¶
        })
    }
}
```

#### 6.4.2 ç¨³å®šæ€§æµ‹è¯•

```go
// é•¿æœŸè¿è¡Œæµ‹è¯•
func TestLongRunningStability(t *testing.T) {
    if testing.Short() {
        t.Skip("Skipping long running test")
    }
    
    detector := NewDetector(DefaultUnlockConfig())
    
    // è¿è¡Œ1å°æ—¶çš„è¿ç»­æ£€æµ‹
    timeout := time.After(1 * time.Hour)
    ticker := time.NewTicker(1 * time.Minute)
    
    for {
        select {
        case <-timeout:
            t.Log("Long running test completed successfully")
            return
        case <-ticker.C:
            // æ‰§è¡Œæ£€æµ‹
            results := detector.DetectAll(testProxy, testPlatforms)
            // éªŒè¯ç»“æœ
            validateResults(t, results)
        }
    }
}
```

### 6.5 å¯ç»´æŠ¤æ€§ä¿éšœ

#### 6.5.1 æµ‹è¯•ä»£ç è´¨é‡

- **æµ‹è¯•ä»£ç å®¡æŸ¥**ï¼šæ‰€æœ‰æµ‹è¯•ä»£ç éƒ½éœ€è¦ç»è¿‡ä»£ç å®¡æŸ¥
- **æµ‹è¯•æ–‡æ¡£**ï¼šä¸ºæ¯ä¸ªæµ‹è¯•ç”¨ä¾‹æä¾›æ¸…æ™°çš„æ–‡æ¡£
- **æµ‹è¯•ç»´æŠ¤**ï¼šå®šæœŸæ›´æ–°å’Œç»´æŠ¤æµ‹è¯•ç”¨ä¾‹
- **æµ‹è¯•é‡æ„**ï¼šå®šæœŸé‡æ„æµ‹è¯•ä»£ç ä»¥æé«˜å¯ç»´æŠ¤æ€§

#### 6.5.2 æµ‹è¯•æŠ¥å‘Šå’Œç›‘æ§

```go
// æµ‹è¯•æŠ¥å‘Šç”Ÿæˆ
type TestReport struct {
    TestSuite     string                `json:"test_suite"`
    TotalTests    int                   `json:"total_tests"`
    PassedTests   int                   `json:"passed_tests"`
    FailedTests   int                   `json:"failed_tests"`
    SkippedTests  int                   `json:"skipped_tests"`
    Coverage      float64               `json:"coverage"`
    Duration      time.Duration         `json:"duration"`
    TestResults   []TestResult          `json:"test_results"`
    Performance   PerformanceMetrics    `json:"performance"`
    Timestamp     time.Time             `json:"timestamp"`
}

func GenerateTestReport(results []TestResult) *TestReport {
    // ç”Ÿæˆæµ‹è¯•æŠ¥å‘Š
    // è®¡ç®—ç»Ÿè®¡ä¿¡æ¯
    // ç”Ÿæˆæ€§èƒ½æŒ‡æ ‡
    return report
}
```

## 7. æµ‹è¯•å·¥å…·å’Œè„šæœ¬

### 7.1 æµ‹è¯•æ‰§è¡Œè„šæœ¬

#### 7.1.1 ç»¼åˆæµ‹è¯•è„šæœ¬

```bash
#!/bin/bash
# run-tests.sh - ç»¼åˆæµ‹è¯•æ‰§è¡Œè„šæœ¬

set -e

# é…ç½®
PROJECT_ROOT=$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)
BACKEND_DIR="$PROJECT_ROOT/backend"
FRONTEND_DIR="$PROJECT_ROOT/frontend"
COVERAGE_DIR="$PROJECT_ROOT/coverage"

# é¢œè‰²å®šä¹‰
RED='\033[0;31m'
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
NC='\033[0m' # No Color

# æ—¥å¿—å‡½æ•°
log_info() {
    echo -e "${GREEN}[INFO]${NC} $1"
}

log_warn() {
    echo -e "${YELLOW}[WARN]${NC} $1"
}

log_error() {
    echo -e "${RED}[ERROR]${NC} $1"
}

# å¸®åŠ©ä¿¡æ¯
show_help() {
    cat << EOF
Usage: $0 [OPTIONS]

Options:
    -h, --help          Show this help message
    -u, --unit          Run unit tests only
    -i, --integration   Run integration tests only
    -e, --e2e           Run E2E tests only
    -p, --performance   Run performance tests only
    -c, --coverage      Generate coverage report
    -v, --verbose       Verbose output
    --backend           Run backend tests only
    --frontend          Run frontend tests only
    --all               Run all tests (default)

Examples:
    $0 --unit --coverage        # Run unit tests with coverage
    $0 --backend --integration  # Run backend integration tests
    $0 --all                   # Run all tests
EOF
}

# è§£æå‘½ä»¤è¡Œå‚æ•°
parse_args() {
    UNIT_TEST=false
    INTEGRATION_TEST=false
    E2E_TEST=false
    PERFORMANCE_TEST=false
    COVERAGE=false
    VERBOSE=false
    BACKEND_ONLY=false
    FRONTEND_ONLY=false
    ALL_TESTS=true

    while [[ $# -gt 0 ]]; do
        case $1 in
            -h|--help)
                show_help
                exit 0
                ;;
            -u|--unit)
                UNIT_TEST=true
                ALL_TESTS=false
                ;;
            -i|--integration)
                INTEGRATION_TEST=true
                ALL_TESTS=false
                ;;
            -e|--e2e)
                E2E_TEST=true
                ALL_TESTS=false
                ;;
            -p|--performance)
                PERFORMANCE_TEST=true
                ALL_TESTS=false
                ;;
            -c|--coverage)
                COVERAGE=true
                ;;
            -v|--verbose)
                VERBOSE=true
                ;;
            --backend)
                BACKEND_ONLY=true
                ALL_TESTS=false
                ;;
            --frontend)
                FRONTEND_ONLY=true
                ALL_TESTS=false
                ;;
            --all)
                ALL_TESTS=true
                ;;
            *)
                log_error "Unknown option: $1"
                show_help
                exit 1
                ;;
        esac
        shift
    done
}

# ç¯å¢ƒæ£€æŸ¥
check_environment() {
    log_info "Checking environment..."
    
    # æ£€æŸ¥Goç¯å¢ƒ
    if ! command -v go &> /dev/null; then
        log_error "Go is not installed"
        exit 1
    fi
    
    # æ£€æŸ¥Node.jsç¯å¢ƒ
    if ! command -v node &> /dev/null; then
        log_error "Node.js is not installed"
        exit 1
    fi
    
    # æ£€æŸ¥Dockerç¯å¢ƒ
    if ! command -v docker &> /dev/null; then
        log_error "Docker is not installed"
        exit 1
    fi
    
    log_info "Environment check passed"
}

# è®¾ç½®æµ‹è¯•ç¯å¢ƒ
setup_test_environment() {
    log_info "Setting up test environment..."
    
    # å¯åŠ¨æµ‹è¯•ä¾èµ–æœåŠ¡
    docker-compose -f docker-compose.test.yml up -d
    
    # ç­‰å¾…æœåŠ¡å¯åŠ¨
    sleep 5
    
    # åˆå§‹åŒ–æµ‹è¯•æ•°æ®
    if [[ -f "$PROJECT_ROOT/scripts/init-test-data.sh" ]]; then
        "$PROJECT_ROOT/scripts/init-test-data.sh"
    fi
    
    log_info "Test environment setup completed"
}

# æ¸…ç†æµ‹è¯•ç¯å¢ƒ
cleanup_test_environment() {
    log_info "Cleaning up test environment..."
    
    # åœæ­¢æµ‹è¯•æœåŠ¡
    docker-compose -f docker-compose.test.yml down
    
    # æ¸…ç†æµ‹è¯•æ•°æ®
    if [[ -f "$PROJECT_ROOT/scripts/cleanup-test-data.sh" ]]; then
        "$PROJECT_ROOT/scripts/cleanup-test-data.sh"
    fi
    
    log_info "Test environment cleanup completed"
}

# åç«¯æµ‹è¯•
run_backend_tests() {
    log_info "Running backend tests..."
    
    cd "$BACKEND_DIR"
    
    # å•å…ƒæµ‹è¯•
    if [[ "$UNIT_TEST" == "true" || "$ALL_TESTS" == "true" ]]; then
        log_info "Running backend unit tests..."
        
        if [[ "$COVERAGE" == "true" ]]; then
            go test -v -race -coverprofile=coverage.out ./...
            go tool cover -html=coverage.out -o "$COVERAGE_DIR/backend-coverage.html"
        else
            go test -v -race ./...
        fi
    fi
    
    # é›†æˆæµ‹è¯•
    if [[ "$INTEGRATION_TEST" == "true" || "$ALL_TESTS" == "true" ]]; then
        log_info "Running backend integration tests..."
        go test -v -tags=integration ./...
    fi
    
    # æ€§èƒ½æµ‹è¯•
    if [[ "$PERFORMANCE_TEST" == "true" || "$ALL_TESTS" == "true" ]]; then
        log_info "Running backend performance tests..."
        go test -v -bench=. -benchmem ./...
    fi
    
    cd "$PROJECT_ROOT"
}

# å‰ç«¯æµ‹è¯•
run_frontend_tests() {
    log_info "Running frontend tests..."
    
    cd "$FRONTEND_DIR"
    
    # å®‰è£…ä¾èµ–
    npm ci
    
    # å•å…ƒæµ‹è¯•
    if [[ "$UNIT_TEST" == "true" || "$ALL_TESTS" == "true" ]]; then
        log_info "Running frontend unit tests..."
        
        if [[ "$COVERAGE" == "true" ]]; then
            npm run test:unit -- --coverage
        else
            npm run test:unit
        fi
    fi
    
    # E2Eæµ‹è¯•
    if [[ "$E2E_TEST" == "true" || "$ALL_TESTS" == "true" ]]; then
        log_info "Running frontend E2E tests..."
        npm run test:e2e
    fi
    
    cd "$PROJECT_ROOT"
}

# ç”Ÿæˆæµ‹è¯•æŠ¥å‘Š
generate_report() {
    if [[ "$COVERAGE" == "true" ]]; then
        log_info "Generating test report..."
        
        # åˆ›å»ºè¦†ç›–ç‡ç›®å½•
        mkdir -p "$COVERAGE_DIR"
        
        # åˆå¹¶è¦†ç›–ç‡æŠ¥å‘Š
        if [[ -f "$BACKEND_DIR/coverage.out" ]]; then
            cp "$BACKEND_DIR/coverage.out" "$COVERAGE_DIR/backend-coverage.out"
        fi
        
        # ç”ŸæˆHTMLæŠ¥å‘Š
        if [[ -f "$COVERAGE_DIR/backend-coverage.out" ]]; then
            go tool cover -html="$COVERAGE_DIR/backend-coverage.out" -o "$COVERAGE_DIR/backend-coverage.html"
        fi
        
        log_info "Test report generated in $COVERAGE_DIR"
    fi
}

# ä¸»å‡½æ•°
main() {
    parse_args "$@"
    
    # åˆ›å»ºè¦†ç›–ç‡ç›®å½•
    mkdir -p "$COVERAGE_DIR"
    
    # è®¾ç½®é”™è¯¯å¤„ç†
    trap cleanup_test_environment EXIT
    
    # æ£€æŸ¥ç¯å¢ƒ
    check_environment
    
    # è®¾ç½®æµ‹è¯•ç¯å¢ƒ
    setup_test_environment
    
    # è¿è¡Œæµ‹è¯•
    if [[ "$BACKEND_ONLY" == "true" || "$ALL_TESTS" == "true" ]]; then
        run_backend_tests
    fi
    
    if [[ "$FRONTEND_ONLY" == "true" || "$ALL_TESTS" == "true" ]]; then
        run_frontend_tests
    fi
    
    # ç”ŸæˆæŠ¥å‘Š
    generate_report
    
    log_info "All tests completed successfully!"
}

# æ‰§è¡Œä¸»å‡½æ•°
main "$@"
```

#### 7.1.2 å¹³å°æ£€æµ‹å™¨æµ‹è¯•ç”Ÿæˆå™¨

```bash
#!/bin/bash
# generate-platform-tests.sh - å¹³å°æ£€æµ‹å™¨æµ‹è¯•ç”Ÿæˆå™¨

set -e

PLATFORM_NAME="$1"
PLATFORM_URL="$2"
PLATFORM_PRIORITY="$3"

if [[ -z "$PLATFORM_NAME" || -z "$PLATFORM_URL" || -z "$PLATFORM_PRIORITY" ]]; then
    echo "Usage: $0 <platform_name> <platform_url> <priority>"
    echo "Example: $0 'Hulu' 'https://www.hulu.com' 1"
    exit 1
fi

# ç”Ÿæˆæ£€æµ‹å™¨æ–‡ä»¶
cat > "${PLATFORM_NAME,,}_detector.go" << EOF
package unlock

import (
    "io"
    "strings"
    "time"

    "github.com/metacubex/mihomo/constant"
)

// ${PLATFORM_NAME}Detector ${PLATFORM_NAME}æ£€æµ‹å™¨
type ${PLATFORM_NAME}Detector struct {
    *BaseDetector
}

// New${PLATFORM_NAME}Detector åˆ›å»º${PLATFORM_NAME}æ£€æµ‹å™¨
func New${PLATFORM_NAME}Detector() *${PLATFORM_NAME}Detector {
    return &${PLATFORM_NAME}Detector{
        BaseDetector: NewBaseDetector("${PLATFORM_NAME}", ${PLATFORM_PRIORITY}),
    }
}

// Detect æ£€æµ‹${PLATFORM_NAME}è§£é”çŠ¶æ€
func (d *${PLATFORM_NAME}Detector) Detect(proxy constant.Proxy, timeout time.Duration) *UnlockResult {
    d.logDetectionStart(proxy)

    client := createHTTPClient(proxy, timeout)

    // è®¿é—®${PLATFORM_NAME}è¿›è¡Œæ£€æµ‹
    resp, err := makeRequest(client, "GET", "${PLATFORM_URL}", nil)
    if err != nil {
        result := d.createErrorResult("Failed to connect to ${PLATFORM_NAME}", err)
        d.logDetectionResult(proxy, result)
        return result
    }
    defer resp.Body.Close()

    body, err := io.ReadAll(resp.Body)
    if err != nil {
        result := d.createErrorResult("Failed to read ${PLATFORM_NAME} response", err)
        d.logDetectionResult(proxy, result)
        return result
    }

    bodyStr := string(body)

    // åˆ†æå“åº”å†…å®¹
    var result *UnlockResult
    if strings.Contains(bodyStr, "Not Available") ||
        strings.Contains(bodyStr, "blocked") ||
        strings.Contains(bodyStr, "unavailable") {
        result = d.createResult(StatusLocked, "", "${PLATFORM_NAME} content not available in this region")
    } else if resp.StatusCode == 200 && strings.Contains(bodyStr, "${PLATFORM_NAME,,}") {
        // å°è¯•æå–åœ°åŒºä¿¡æ¯
        region := d.extractRegion(bodyStr)
        result = d.createResult(StatusUnlocked, region, "${PLATFORM_NAME} accessible")
    } else {
        result = d.createResult(StatusFailed, "", "Unable to determine ${PLATFORM_NAME} status")
    }

    d.logDetectionResult(proxy, result)
    return result
}

// extractRegion ä»å“åº”ä¸­æå–åœ°åŒºä¿¡æ¯
func (d *${PLATFORM_NAME}Detector) extractRegion(body string) string {
    // TODO: å®ç°åœ°åŒºæå–é€»è¾‘
    return ""
}
EOF

# ç”Ÿæˆæµ‹è¯•æ–‡ä»¶
cat > "${PLATFORM_NAME,,}_detector_test.go" << EOF
package unlock

import (
    "errors"
    "testing"
    "time"

    "github.com/stretchr/testify/assert"
    "github.com/stretchr/testify/mock"
)

func Test${PLATFORM_NAME}Detector(t *testing.T) {
    detector := New${PLATFORM_NAME}Detector()
    
    assert.Equal(t, "${PLATFORM_NAME}", detector.GetPlatformName())
    assert.Equal(t, ${PLATFORM_PRIORITY}, detector.GetPriority())
    
    testCases := []struct {
        name           string
        mockResponse   MockResponse
        expectedStatus UnlockStatus
        expectedRegion string
        expectedError  bool
    }{
        {
            name: "æˆåŠŸè§£é”",
            mockResponse: MockResponse{
                Status: 200,
                Body:   \`{"region": "US", "available": true}\`,
            },
            expectedStatus: StatusUnlocked,
            expectedRegion: "US",
            expectedError:  false,
        },
        {
            name: "åœ°åŒºå°é”",
            mockResponse: MockResponse{
                Status: 200,
                Body:   \`{"error": "Not Available"}\`,
            },
            expectedStatus: StatusLocked,
            expectedRegion: "",
            expectedError:  false,
        },
        {
            name: "ç½‘ç»œé”™è¯¯",
            mockResponse: MockResponse{
                Status: 0,
                Body:   "",
                Error:  errors.New("network error"),
            },
            expectedStatus: StatusError,
            expectedRegion: "",
            expectedError:  true,
        },
        {
            name: "æœåŠ¡å™¨é”™è¯¯",
            mockResponse: MockResponse{
                Status: 500,
                Body:   "Internal Server Error",
            },
            expectedStatus: StatusFailed,
            expectedRegion: "",
            expectedError:  false,
        },
    }
    
    for _, tc := range testCases {
        t.Run(tc.name, func(t *testing.T) {
            // åˆ›å»ºMockä»£ç†
            mockProxy := &MockProxy{}
            mockProxy.On("Name").Return("test-proxy")
            mockProxy.On("DialContext", mock.Anything, mock.Anything).Return(nil, tc.mockResponse.Error)
            
            // æ‰§è¡Œæ£€æµ‹
            result := detector.Detect(mockProxy, 10*time.Second)
            
            // éªŒè¯ç»“æœ
            assert.Equal(t, tc.expectedStatus, result.Status)
            assert.Equal(t, tc.expectedRegion, result.Region)
            assert.Equal(t, "${PLATFORM_NAME}", result.Platform)
            
            if tc.expectedError {
                assert.Equal(t, StatusError, result.Status)
                assert.NotEmpty(t, result.Message)
            }
        })
    }
}

func Test${PLATFORM_NAME}DetectorExtractRegion(t *testing.T) {
    detector := New${PLATFORM_NAME}Detector()
    
    testCases := []struct {
        name           string
        responseBody   string
        expectedRegion string
    }{
        {
            name:           "USåœ°åŒº",
            responseBody:   \`{"region": "US", "country": "United States"}\`,
            expectedRegion: "US",
        },
        {
            name:           "æ—¥æœ¬åœ°åŒº",
            responseBody:   \`{"region": "JP", "country": "Japan"}\`,
            expectedRegion: "JP",
        },
        {
            name:           "æ— åœ°åŒºä¿¡æ¯",
            responseBody:   \`{"status": "ok"}\`,
            expectedRegion: "",
        },
    }
    
    for _, tc := range testCases {
        t.Run(tc.name, func(t *testing.T) {
            region := detector.extractRegion(tc.responseBody)
            assert.Equal(t, tc.expectedRegion, region)
        })
    }
}

func Benchmark${PLATFORM_NAME}Detector(b *testing.B) {
    detector := New${PLATFORM_NAME}Detector()
    mockProxy := &MockProxy{}
    mockProxy.On("Name").Return("test-proxy")
    mockProxy.On("DialContext", mock.Anything, mock.Anything).Return(nil, nil)
    
    b.ResetTimer()
    for i := 0; i < b.N; i++ {
        detector.Detect(mockProxy, 10*time.Second)
    }
}
EOF

echo "Generated ${PLATFORM_NAME} detector and test files:"
echo "  - ${PLATFORM_NAME,,}_detector.go"
echo "  - ${PLATFORM_NAME,,}_detector_test.go"
echo ""
echo "Please:"
echo "1. å®ç° extractRegion æ–¹æ³•"
echo "2. æ ¹æ®å®é™…APIå“åº”è°ƒæ•´æ£€æµ‹é€»è¾‘"
echo "3. æ·»åŠ åˆ° detector.go çš„ registerDefaultDetectors æ–¹æ³•ä¸­"
echo "4. è¿è¡Œæµ‹è¯•: go test -v ./${PLATFORM_NAME,,}_detector_test.go"
```

### 7.2 æŒç»­é›†æˆé…ç½®

#### 7.2.1 å®Œæ•´çš„GitHub Actionså·¥ä½œæµ

```yaml
# .github/workflows/comprehensive-test.yml
name: Comprehensive Test Suite

on:
  push:
    branches: [ main, develop ]
  pull_request:
    branches: [ main ]
  schedule:
    - cron: '0 2 * * *'  # æ¯å¤©å‡Œæ™¨2ç‚¹è¿è¡Œ

env:
  GO_VERSION: 1.21
  NODE_VERSION: 18
  GOLANGCI_LINT_VERSION: v1.54

jobs:
  # ä»£ç è´¨é‡æ£€æŸ¥
  code-quality:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v4
    
    - name: Set up Go
      uses: actions/setup-go@v4
      with:
        go-version: ${{ env.GO_VERSION }}
    
    - name: golangci-lint
      uses: golangci/golangci-lint-action@v3
      with:
        version: ${{ env.GOLANGCI_LINT_VERSION }}
        working-directory: backend
    
    - name: Set up Node.js
      uses: actions/setup-node@v3
      with:
        node-version: ${{ env.NODE_VERSION }}
        cache: 'npm'
        cache-dependency-path: frontend/package-lock.json
    
    - name: Frontend linting
      run: |
        cd frontend
        npm ci
        npm run lint
    
    - name: Security scan
      run: |
        cd backend
        go install github.com/securecodewarrior/gosec/v2/cmd/gosec@latest
        gosec ./...

  # åç«¯æµ‹è¯•
  backend-tests:
    runs-on: ubuntu-latest
    needs: code-quality
    
    strategy:
      matrix:
        go-version: [1.21, 1.22]
        test-type: [unit, integration, performance]
    
    services:
      redis:
        image: redis:7-alpine
        ports:
          - 6379:6379
        options: >-
          --health-cmd "redis-cli ping"
          --health-interval 10s
          --health-timeout 5s
          --health-retries 5
    
    steps:
    - uses: actions/checkout@v4
    
    - name: Set up Go
      uses: actions/setup-go@v4
      with:
        go-version: ${{ matrix.go-version }}
    
    - name: Cache Go modules
      uses: actions/cache@v3
      with:
        path: |
          ~/.cache/go-build
          ~/go/pkg/mod
        key: ${{ runner.os }}-go-${{ matrix.go-version }}-${{ hashFiles('**/go.sum') }}
        restore-keys: |
          ${{ runner.os }}-go-${{ matrix.go-version }}-
    
    - name: Install dependencies
      run: |
        cd backend
        go mod tidy
        go install github.com/golang/mock/mockgen@latest
    
    - name: Run unit tests
      if: matrix.test-type == 'unit'
      run: |
        cd backend
        go test -v -race -coverprofile=coverage.out ./...
    
    - name: Run integration tests
      if: matrix.test-type == 'integration'
      run: |
        cd backend
        go test -v -tags=integration ./...
    
    - name: Run performance tests
      if: matrix.test-type == 'performance'
      run: |
        cd backend
        go test -v -bench=. -benchmem ./...
    
    - name: Upload coverage to Codecov
      if: matrix.test-type == 'unit' && matrix.go-version == '1.21'
      uses: codecov/codecov-action@v3
      with:
        file: ./backend/coverage.out
        flags: backend
        name: backend-coverage

  # å‰ç«¯æµ‹è¯•
  frontend-tests:
    runs-on: ubuntu-latest
    needs: code-quality
    
    strategy:
      matrix:
        node-version: [18, 20]
        test-type: [unit, e2e]
    
    steps:
    - uses: actions/checkout@v4
    
    - name: Set up Node.js
      uses: actions/setup-node@v3
      with:
        node-version: ${{ matrix.node-version }}
        cache: 'npm'
        cache-dependency-path: frontend/package-lock.json
    
    - name: Install dependencies
      run: |
        cd frontend
        npm ci
    
    - name: Run unit tests
      if: matrix.test-type == 'unit'
      run: |
        cd frontend
        npm run test:unit -- --coverage
    
    - name: Install Playwright browsers
      if: matrix.test-type == 'e2e'
      run: |
        cd frontend
        npx playwright install --with-deps
    
    - name: Run E2E tests
      if: matrix.test-type == 'e2e'
      run: |
        cd frontend
        npm run test:e2e
    
    - name: Upload E2E test results
      if: matrix.test-type == 'e2e' && always()
      uses: actions/upload-artifact@v3
      with:
        name: e2e-results-${{ matrix.node-version }}
        path: frontend/test-results/
        retention-days: 30

  # é›†æˆæµ‹è¯•
  integration-tests:
    runs-on: ubuntu-latest
    needs: [backend-tests, frontend-tests]
    
    services:
      mock-server:
        image: mockserver/mockserver:latest
        ports:
          - 1080:1080
    
    steps:
    - uses: actions/checkout@v4
    
    - name: Set up Go
      uses: actions/setup-go@v4
      with:
        go-version: ${{ env.GO_VERSION }}
    
    - name: Set up Node.js
      uses: actions/setup-node@v3
      with:
        node-version: ${{ env.NODE_VERSION }}
        cache: 'npm'
        cache-dependency-path: frontend/package-lock.json
    
    - name: Start test environment
      run: |
        docker-compose -f docker-compose.test.yml up -d
        sleep 30  # ç­‰å¾…æœåŠ¡å¯åŠ¨
    
    - name: Run integration tests
      run: |
        ./scripts/run-integration-tests.sh
    
    - name: Cleanup test environment
      if: always()
      run: |
        docker-compose -f docker-compose.test.yml down

  # æ€§èƒ½æµ‹è¯•
  performance-tests:
    runs-on: ubuntu-latest
    needs: integration-tests
    if: github.event_name == 'schedule' || contains(github.event.head_commit.message, '[perf]')
    
    steps:
    - uses: actions/checkout@v4
    
    - name: Set up Go
      uses: actions/setup-go@v4
      with:
        go-version: ${{ env.GO_VERSION }}
    
    - name: Run performance tests
      run: |
        cd backend
        go test -v -bench=. -benchmem -count=3 ./... | tee performance-results.txt
    
    - name: Performance regression check
      run: |
        # æ¯”è¾ƒæ€§èƒ½ç»“æœå¹¶æ£€æŸ¥å›å½’
        ./scripts/check-performance-regression.sh
    
    - name: Upload performance results
      uses: actions/upload-artifact@v3
      with:
        name: performance-results
        path: backend/performance-results.txt

  # å®‰å…¨æµ‹è¯•
  security-tests:
    runs-on: ubuntu-latest
    needs: code-quality
    
    steps:
    - uses: actions/checkout@v4
    
    - name: Run Trivy vulnerability scanner
      uses: aquasecurity/trivy-action@master
      with:
        scan-type: 'fs'
        scan-ref: '.'
        format: 'sarif'
        output: 'trivy-results.sarif'
    
    - name: Upload Trivy scan results
      uses: github/codeql-action/upload-sarif@v2
      with:
        sarif_file: 'trivy-results.sarif'
    
    - name: Dependency security audit
      run: |
        cd backend
        go list -json -m all | nancy sleuth
        
        cd ../frontend
        npm audit --audit-level high

  # éƒ¨ç½²é¢„è§ˆ
  deploy-preview:
    runs-on: ubuntu-latest
    needs: [backend-tests, frontend-tests, integration-tests]
    if: github.event_name == 'pull_request'
    
    steps:
    - uses: actions/checkout@v4
    
    - name: Build application
      run: |
        ./scripts/build-preview.sh
    
    - name: Deploy to staging
      run: |
        # éƒ¨ç½²åˆ°é¢„è§ˆç¯å¢ƒ
        ./scripts/deploy-preview.sh
    
    - name: Comment PR
      uses: actions/github-script@v6
      with:
        script: |
          github.rest.issues.createComment({
            issue_number: context.issue.number,
            owner: context.repo.owner,
            repo: context.repo.repo,
            body: 'ğŸš€ é¢„è§ˆç¯å¢ƒå·²éƒ¨ç½²ï¼šhttps://preview-${{ github.event.number }}.example.com'
          })

  # æµ‹è¯•æŠ¥å‘Š
  test-report:
    runs-on: ubuntu-latest
    needs: [backend-tests, frontend-tests, integration-tests, performance-tests, security-tests]
    if: always()
    
    steps:
    - uses: actions/checkout@v4
    
    - name: Download all artifacts
      uses: actions/download-artifact@v3
    
    - name: Generate comprehensive test report
      run: |
        ./scripts/generate-test-report.sh
    
    - name: Upload test report
      uses: actions/upload-artifact@v3
      with:
        name: comprehensive-test-report
        path: test-report/
        retention-days: 90
    
    - name: Notify on failure
      if: failure()
      uses: actions/github-script@v6
      with:
        script: |
          github.rest.issues.create({
            owner: context.repo.owner,
            repo: context.repo.repo,
            title: 'æµ‹è¯•å¤±è´¥ - ${{ github.sha }}',
            body: 'æµ‹è¯•å¥—ä»¶åœ¨ ${{ github.ref }} åˆ†æ”¯ä¸Šå¤±è´¥ã€‚è¯·æ£€æŸ¥å·¥ä½œæµæ—¥å¿—ã€‚',
            labels: ['bug', 'test-failure']
          })
```

## æ€»ç»“

æœ¬æµ‹è¯•ç­–ç•¥æ–‡æ¡£ä¸ºclash-speedtesté¡¹ç›®çš„è§£é”æ£€æµ‹åŠŸèƒ½é‡æ„æä¾›äº†å…¨é¢çš„æµ‹è¯•æŒ‡å¯¼ã€‚é€šè¿‡å®æ–½è¿™ä¸ªæµ‹è¯•ç­–ç•¥ï¼Œæˆ‘ä»¬å¯ä»¥ï¼š

### ä¸»è¦æˆæœ

1. **å»ºç«‹å®Œæ•´çš„æµ‹è¯•ä½“ç³»**ï¼šä»å•å…ƒæµ‹è¯•åˆ°ç«¯åˆ°ç«¯æµ‹è¯•çš„å…¨è¦†ç›–
2. **ç¡®ä¿é‡æ„è´¨é‡**ï¼šé€šè¿‡è‡ªåŠ¨åŒ–æµ‹è¯•ä¿è¯åŠŸèƒ½æ­£ç¡®æ€§
3. **æé«˜å¼€å‘æ•ˆç‡**ï¼šé€šè¿‡CI/CDè‡ªåŠ¨åŒ–å‡å°‘æ‰‹å·¥æµ‹è¯•å·¥ä½œ
4. **ä¿éšœç³»ç»Ÿç¨³å®šæ€§**ï¼šé€šè¿‡æ€§èƒ½æµ‹è¯•å’Œå‹åŠ›æµ‹è¯•ç¡®ä¿ç³»ç»Ÿå¯é æ€§

### å…³é”®æŒ‡æ ‡

- **æµ‹è¯•è¦†ç›–ç‡**ï¼šå•å…ƒæµ‹è¯• >= 85%ï¼Œé›†æˆæµ‹è¯• >= 70%
- **æµ‹è¯•æ‰§è¡Œæ—¶é—´**ï¼šå•å…ƒæµ‹è¯• < 5åˆ†é’Ÿï¼Œé›†æˆæµ‹è¯• < 15åˆ†é’Ÿ
- **è´¨é‡é—¨ç¦**ï¼šæ‰€æœ‰æµ‹è¯•å¿…é¡»é€šè¿‡æ‰èƒ½åˆå¹¶ä»£ç 
- **æ€§èƒ½åŸºå‡†**ï¼šæ£€æµ‹æ—¶é—´ < 30ç§’ï¼Œå†…å­˜ä½¿ç”¨ < 100MB

### å®æ–½å»ºè®®

1. **åˆ†é˜¶æ®µå®æ–½**ï¼šæŒ‰ç…§5ä¸ªé˜¶æ®µé€æ­¥å»ºç«‹æµ‹è¯•ä½“ç³»
2. **æŒç»­æ”¹è¿›**ï¼šå®šæœŸreviewå’Œä¼˜åŒ–æµ‹è¯•ç”¨ä¾‹
3. **å›¢é˜ŸåŸ¹è®­**ï¼šç¡®ä¿å›¢é˜Ÿæˆå‘˜æŒæ¡æµ‹è¯•å·¥å…·å’Œæ–¹æ³•
4. **ç›‘æ§æŒ‡æ ‡**ï¼šæŒç»­ç›‘æ§æµ‹è¯•æŒ‡æ ‡å’Œä»£ç è´¨é‡

é€šè¿‡è¿™ä¸ªç»¼åˆæ€§çš„æµ‹è¯•ç­–ç•¥ï¼Œæˆ‘ä»¬èƒ½å¤Ÿç¡®ä¿ä»6ä¸ªå¹³å°æ‰©å±•åˆ°40+ä¸ªå¹³å°çš„é‡æ„é¡¹ç›®é«˜è´¨é‡å®Œæˆï¼ŒåŒæ—¶ä¸ºåç»­çš„åŠŸèƒ½è¿­ä»£å¥ å®šåšå®çš„æµ‹è¯•åŸºç¡€ã€‚
